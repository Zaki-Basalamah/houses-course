{"ast":null,"code":"var _dec, _dec2, _dec3, _dec4, _dec5, _dec6, _dec7, _dec8, _dec9, _class, _class2, _descriptor, _descriptor2, _temp, _dec10, _dec11, _dec12, _dec13, _dec14, _class4, _class5, _descriptor3, _descriptor4, _temp2, _dec15, _dec16, _dec17, _dec18, _dec19, _dec20, _dec21, _dec22, _dec23, _class7, _class8, _descriptor5, _descriptor6, _descriptor7, _descriptor8, _temp3, _dec24, _dec25, _dec26, _dec27, _dec28, _dec29, _dec30, _dec31, _dec32, _dec33, _dec34, _dec35, _dec36, _dec37, _dec38, _dec39, _dec40, _dec41, _dec42, _dec43, _dec44, _dec45, _class10, _class11, _descriptor9, _descriptor10, _descriptor11, _descriptor12, _descriptor13, _descriptor14, _descriptor15, _temp4, _dec46, _dec47, _dec48, _dec49, _dec50, _dec51, _dec52, _dec53, _dec54, _dec55, _dec56, _dec57, _dec58, _dec59, _dec60, _dec61, _dec62, _dec63, _dec64, _dec65, _dec66, _dec67, _dec68, _dec69, _dec70, _dec71, _dec72, _dec73, _dec74, _dec75, _class13, _class14;\n\nfunction _initializerDefineProperty(target, property, descriptor, context) { if (!descriptor) return; Object.defineProperty(target, property, { enumerable: descriptor.enumerable, configurable: descriptor.configurable, writable: descriptor.writable, value: descriptor.initializer ? descriptor.initializer.call(context) : void 0 }); }\n\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) { var desc = {}; Object.keys(descriptor).forEach(function (key) { desc[key] = descriptor[key]; }); desc.enumerable = !!desc.enumerable; desc.configurable = !!desc.configurable; if ('value' in desc || desc.initializer) { desc.writable = true; } desc = decorators.slice().reverse().reduce(function (desc, decorator) { return decorator(target, property, desc) || desc; }, desc); if (context && desc.initializer !== void 0) { desc.value = desc.initializer ? desc.initializer.call(context) : void 0; desc.initializer = undefined; } if (desc.initializer === void 0) { Object.defineProperty(target, property, desc); desc = null; } return desc; }\n\nfunction _initializerWarningHelper(descriptor, context) { throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and runs after the decorators transform.'); }\n\nimport { ObjectType, InputType, Field, ID, Float, Int, Resolver, Query, Mutation, Arg, Ctx, Authorized } from \"type-graphql\";\nimport { Min, Max } from \"class-validator\";\nimport { getBoundsOfDistance } from \"geolib\";\nimport { Context, AuthorizedContext } from \"./context\";\nlet CoordinatesInput = (_dec = InputType(), _dec2 = Min(-90), _dec3 = Max(90), _dec4 = Field(_type => Float), _dec5 = Reflect.metadata(\"design:type\", Number), _dec6 = Min(-180), _dec7 = Max(180), _dec8 = Field(_type => Float), _dec9 = Reflect.metadata(\"design:type\", Number), _dec(_class = (_class2 = (_temp = class CoordinatesInput {\n  constructor() {\n    _initializerDefineProperty(this, \"latitude\", _descriptor, this);\n\n    _initializerDefineProperty(this, \"longitude\", _descriptor2, this);\n  }\n\n}, _temp), (_descriptor = _applyDecoratedDescriptor(_class2.prototype, \"latitude\", [_dec2, _dec3, _dec4, _dec5], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor2 = _applyDecoratedDescriptor(_class2.prototype, \"longitude\", [_dec6, _dec7, _dec8, _dec9], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n})), _class2)) || _class);\nlet BoundsInput = (_dec10 = InputType(), _dec11 = Field(_type => CoordinatesInput), _dec12 = Reflect.metadata(\"design:type\", typeof CoordinatesInput === \"undefined\" ? Object : CoordinatesInput), _dec13 = Field(_type => CoordinatesInput), _dec14 = Reflect.metadata(\"design:type\", typeof CoordinatesInput === \"undefined\" ? Object : CoordinatesInput), _dec10(_class4 = (_class5 = (_temp2 = class BoundsInput {\n  constructor() {\n    _initializerDefineProperty(this, \"sw\", _descriptor3, this);\n\n    _initializerDefineProperty(this, \"ne\", _descriptor4, this);\n  }\n\n}, _temp2), (_descriptor3 = _applyDecoratedDescriptor(_class5.prototype, \"sw\", [_dec11, _dec12], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor4 = _applyDecoratedDescriptor(_class5.prototype, \"ne\", [_dec13, _dec14], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n})), _class5)) || _class4);\nlet HouseInput = (_dec15 = InputType(), _dec16 = Field(_type => String), _dec17 = Reflect.metadata(\"design:type\", String), _dec18 = Field(_type => String), _dec19 = Reflect.metadata(\"design:type\", String), _dec20 = Field(_type => CoordinatesInput), _dec21 = Reflect.metadata(\"design:type\", typeof CoordinatesInput === \"undefined\" ? Object : CoordinatesInput), _dec22 = Field(_type => Int), _dec23 = Reflect.metadata(\"design:type\", Number), _dec15(_class7 = (_class8 = (_temp3 = class HouseInput {\n  constructor() {\n    _initializerDefineProperty(this, \"address\", _descriptor5, this);\n\n    _initializerDefineProperty(this, \"image\", _descriptor6, this);\n\n    _initializerDefineProperty(this, \"coordinates\", _descriptor7, this);\n\n    _initializerDefineProperty(this, \"bedrooms\", _descriptor8, this);\n  }\n\n}, _temp3), (_descriptor5 = _applyDecoratedDescriptor(_class8.prototype, \"address\", [_dec16, _dec17], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor6 = _applyDecoratedDescriptor(_class8.prototype, \"image\", [_dec18, _dec19], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor7 = _applyDecoratedDescriptor(_class8.prototype, \"coordinates\", [_dec20, _dec21], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor8 = _applyDecoratedDescriptor(_class8.prototype, \"bedrooms\", [_dec22, _dec23], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n})), _class8)) || _class7);\nlet House = (_dec24 = ObjectType(), _dec25 = Field(_type => ID), _dec26 = Reflect.metadata(\"design:type\", Number), _dec27 = Field(_type => String), _dec28 = Reflect.metadata(\"design:type\", String), _dec29 = Field(_type => Float), _dec30 = Reflect.metadata(\"design:type\", Number), _dec31 = Field(_type => Float), _dec32 = Reflect.metadata(\"design:type\", Number), _dec33 = Field(_type => String), _dec34 = Reflect.metadata(\"design:type\", String), _dec35 = Field(_type => String), _dec36 = Reflect.metadata(\"design:type\", String), _dec37 = Field(_type => String), _dec38 = Reflect.metadata(\"design:type\", Function), _dec39 = Reflect.metadata(\"design:paramtypes\", []), _dec40 = Field(_type => Int), _dec41 = Reflect.metadata(\"design:type\", Number), _dec42 = Field(_type => [House]), _dec43 = function (target, key) {\n  return Ctx()(target, key, 0);\n}, _dec44 = Reflect.metadata(\"design:type\", Function), _dec45 = Reflect.metadata(\"design:paramtypes\", [typeof Context === \"undefined\" ? Object : Context]), _dec24(_class10 = (_class11 = (_temp4 = class House {\n  constructor() {\n    _initializerDefineProperty(this, \"id\", _descriptor9, this);\n\n    _initializerDefineProperty(this, \"userId\", _descriptor10, this);\n\n    _initializerDefineProperty(this, \"latitude\", _descriptor11, this);\n\n    _initializerDefineProperty(this, \"longitude\", _descriptor12, this);\n\n    _initializerDefineProperty(this, \"address\", _descriptor13, this);\n\n    _initializerDefineProperty(this, \"image\", _descriptor14, this);\n\n    _initializerDefineProperty(this, \"bedrooms\", _descriptor15, this);\n  }\n\n  publicId() {\n    const parts = this.image.split(\"/\");\n    return parts[parts.length - 1];\n  }\n\n  async nearby(ctx) {\n    const bounds = getBoundsOfDistance({\n      latitude: this.latitude,\n      longitude: this.longitude\n    }, 10000);\n    return ctx.prisma.house.findMany({\n      where: {\n        latitude: {\n          gte: bounds[0].latitude,\n          lte: bounds[1].latitude\n        },\n        longitude: {\n          gte: bounds[0].longitude,\n          lte: bounds[1].longitude\n        },\n        id: {\n          not: {\n            equals: this.id\n          }\n        }\n      },\n      take: 25\n    });\n  }\n\n}, _temp4), (_descriptor9 = _applyDecoratedDescriptor(_class11.prototype, \"id\", [_dec25, _dec26], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor10 = _applyDecoratedDescriptor(_class11.prototype, \"userId\", [_dec27, _dec28], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor11 = _applyDecoratedDescriptor(_class11.prototype, \"latitude\", [_dec29, _dec30], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor12 = _applyDecoratedDescriptor(_class11.prototype, \"longitude\", [_dec31, _dec32], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor13 = _applyDecoratedDescriptor(_class11.prototype, \"address\", [_dec33, _dec34], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor14 = _applyDecoratedDescriptor(_class11.prototype, \"image\", [_dec35, _dec36], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _applyDecoratedDescriptor(_class11.prototype, \"publicId\", [_dec37, _dec38, _dec39], Object.getOwnPropertyDescriptor(_class11.prototype, \"publicId\"), _class11.prototype), _descriptor15 = _applyDecoratedDescriptor(_class11.prototype, \"bedrooms\", [_dec40, _dec41], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _applyDecoratedDescriptor(_class11.prototype, \"nearby\", [_dec42, _dec43, _dec44, _dec45], Object.getOwnPropertyDescriptor(_class11.prototype, \"nearby\"), _class11.prototype)), _class11)) || _class10);\nexport let HouseResolver = (_dec46 = Resolver(), _dec47 = Query(_returns => House, {\n  nullable: true\n}), _dec48 = function (target, key) {\n  return Arg(\"id\")(target, key, 0);\n}, _dec49 = function (target, key) {\n  return Ctx()(target, key, 1);\n}, _dec50 = Reflect.metadata(\"design:type\", Function), _dec51 = Reflect.metadata(\"design:paramtypes\", [String, typeof Context === \"undefined\" ? Object : Context]), _dec52 = Query(_returns => [House], {\n  nullable: false\n}), _dec53 = function (target, key) {\n  return Arg(\"bounds\")(target, key, 0);\n}, _dec54 = function (target, key) {\n  return Ctx()(target, key, 1);\n}, _dec55 = Reflect.metadata(\"design:type\", Function), _dec56 = Reflect.metadata(\"design:paramtypes\", [typeof BoundsInput === \"undefined\" ? Object : BoundsInput, typeof Context === \"undefined\" ? Object : Context]), _dec57 = Authorized(), _dec58 = Mutation(_returns => House, {\n  nullable: true\n}), _dec59 = function (target, key) {\n  return Arg(\"input\")(target, key, 0);\n}, _dec60 = function (target, key) {\n  return Ctx()(target, key, 1);\n}, _dec61 = Reflect.metadata(\"design:type\", Function), _dec62 = Reflect.metadata(\"design:paramtypes\", [typeof HouseInput === \"undefined\" ? Object : HouseInput, typeof AuthorizedContext === \"undefined\" ? Object : AuthorizedContext]), _dec63 = Authorized(), _dec64 = Mutation(_returns => House, {\n  nullable: true\n}), _dec65 = function (target, key) {\n  return Arg(\"id\")(target, key, 0);\n}, _dec66 = function (target, key) {\n  return Arg(\"input\")(target, key, 1);\n}, _dec67 = function (target, key) {\n  return Ctx()(target, key, 2);\n}, _dec68 = Reflect.metadata(\"design:type\", Function), _dec69 = Reflect.metadata(\"design:paramtypes\", [String, typeof HouseInput === \"undefined\" ? Object : HouseInput, typeof AuthorizedContext === \"undefined\" ? Object : AuthorizedContext]), _dec70 = Authorized(), _dec71 = Mutation(_returns => Boolean, {\n  nullable: false\n}), _dec72 = function (target, key) {\n  return Arg(\"id\")(target, key, 0);\n}, _dec73 = function (target, key) {\n  return Ctx()(target, key, 1);\n}, _dec74 = Reflect.metadata(\"design:type\", Function), _dec75 = Reflect.metadata(\"design:paramtypes\", [String, typeof AuthorizedContext === \"undefined\" ? Object : AuthorizedContext]), _dec46(_class13 = (_class14 = class HouseResolver {\n  async house(id, ctx) {\n    return ctx.prisma.house.findOne({\n      where: {\n        id: parseInt(id, 10)\n      }\n    });\n  }\n\n  async houses(bounds, ctx) {\n    return ctx.prisma.house.findMany({\n      where: {\n        latitude: {\n          gte: bounds.sw.latitude,\n          lte: bounds.ne.latitude\n        },\n        longitude: {\n          gte: bounds.sw.longitude,\n          lte: bounds.ne.longitude\n        }\n      },\n      take: 50\n    });\n  }\n\n  async createHouse(input, ctx) {\n    return await ctx.prisma.house.create({\n      data: {\n        userId: ctx.uid,\n        image: input.image,\n        address: input.address,\n        latitude: input.coordinates.latitude,\n        longitude: input.coordinates.longitude,\n        bedrooms: input.bedrooms\n      }\n    });\n  }\n\n  async updateHouse(id, input, ctx) {\n    const houseId = parseInt(id, 10);\n    const house = await ctx.prisma.house.findOne({\n      where: {\n        id: houseId\n      }\n    });\n    if (!house || house.userId !== ctx.uid) return null;\n    return await ctx.prisma.house.update({\n      where: {\n        id: houseId\n      },\n      data: {\n        image: input.image,\n        address: input.address,\n        latitude: input.coordinates.latitude,\n        longitude: input.coordinates.longitude,\n        bedrooms: input.bedrooms\n      }\n    });\n  }\n\n  async deleteHouse(id, ctx) {\n    const houseId = parseInt(id, 10);\n    const house = await ctx.prisma.house.findOne({\n      where: {\n        id: houseId\n      }\n    });\n    if (!house || house.userId !== ctx.uid) return false;\n    await ctx.prisma.house.delete({\n      where: {\n        id: houseId\n      }\n    });\n    return true;\n  }\n\n}, (_applyDecoratedDescriptor(_class14.prototype, \"house\", [_dec47, _dec48, _dec49, _dec50, _dec51], Object.getOwnPropertyDescriptor(_class14.prototype, \"house\"), _class14.prototype), _applyDecoratedDescriptor(_class14.prototype, \"houses\", [_dec52, _dec53, _dec54, _dec55, _dec56], Object.getOwnPropertyDescriptor(_class14.prototype, \"houses\"), _class14.prototype), _applyDecoratedDescriptor(_class14.prototype, \"createHouse\", [_dec57, _dec58, _dec59, _dec60, _dec61, _dec62], Object.getOwnPropertyDescriptor(_class14.prototype, \"createHouse\"), _class14.prototype), _applyDecoratedDescriptor(_class14.prototype, \"updateHouse\", [_dec63, _dec64, _dec65, _dec66, _dec67, _dec68, _dec69], Object.getOwnPropertyDescriptor(_class14.prototype, \"updateHouse\"), _class14.prototype), _applyDecoratedDescriptor(_class14.prototype, \"deleteHouse\", [_dec70, _dec71, _dec72, _dec73, _dec74, _dec75], Object.getOwnPropertyDescriptor(_class14.prototype, \"deleteHouse\"), _class14.prototype)), _class14)) || _class13);","map":{"version":3,"sources":["C:/Users/Windows/Desktop/housestreetcourse/house-course/src/schema/house.ts"],"names":["ObjectType","InputType","Field","ID","Float","Int","Resolver","Query","Mutation","Arg","Ctx","Authorized","Min","Max","getBoundsOfDistance","Context","AuthorizedContext","CoordinatesInput","_type","BoundsInput","HouseInput","String","House","publicId","parts","image","split","length","nearby","ctx","bounds","latitude","longitude","prisma","house","findMany","where","gte","lte","id","not","equals","take","HouseResolver","_returns","nullable","Boolean","findOne","parseInt","houses","sw","ne","createHouse","input","create","data","userId","uid","address","coordinates","bedrooms","updateHouse","houseId","update","deleteHouse","delete"],"mappings":"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","sourcesContent":["import {\r\n  ObjectType,\r\n  InputType,\r\n  Field,\r\n  ID,\r\n  Float,\r\n  Int,\r\n  Resolver,\r\n  Query,\r\n  Mutation,\r\n  Arg,\r\n  Ctx,\r\n  Authorized,\r\n} from \"type-graphql\";\r\nimport { Min, Max } from \"class-validator\";\r\nimport { getBoundsOfDistance } from \"geolib\";\r\nimport { Context, AuthorizedContext } from \"./context\";\r\n\r\n@InputType()\r\nclass CoordinatesInput {\r\n  @Min(-90)\r\n  @Max(90)\r\n  @Field((_type) => Float)\r\n  latitude!: number;\r\n\r\n  @Min(-180)\r\n  @Max(180)\r\n  @Field((_type) => Float)\r\n  longitude!: number;\r\n}\r\n\r\n@InputType()\r\nclass BoundsInput {\r\n  @Field((_type) => CoordinatesInput)\r\n  sw!: CoordinatesInput;\r\n\r\n  @Field((_type) => CoordinatesInput)\r\n  ne!: CoordinatesInput;\r\n}\r\n\r\n@InputType()\r\nclass HouseInput {\r\n  @Field((_type) => String)\r\n  address!: string;\r\n\r\n  @Field((_type) => String)\r\n  image!: string;\r\n\r\n  @Field((_type) => CoordinatesInput)\r\n  coordinates!: CoordinatesInput;\r\n\r\n  @Field((_type) => Int)\r\n  bedrooms!: number;\r\n}\r\n\r\n@ObjectType()\r\nclass House {\r\n  @Field((_type) => ID)\r\n  id!: number;\r\n\r\n  @Field((_type) => String)\r\n  userId!: string;\r\n\r\n  @Field((_type) => Float)\r\n  latitude!: number;\r\n\r\n  @Field((_type) => Float)\r\n  longitude!: number;\r\n\r\n  @Field((_type) => String)\r\n  address!: string;\r\n\r\n  @Field((_type) => String)\r\n  image!: string;\r\n\r\n  @Field((_type) => String)\r\n  publicId(): string {\r\n    const parts = this.image.split(\"/\");\r\n    return parts[parts.length - 1];\r\n  }\r\n\r\n  @Field((_type) => Int)\r\n  bedrooms!: number;\r\n\r\n  @Field((_type) => [House])\r\n  async nearby(@Ctx() ctx: Context) {\r\n    const bounds = getBoundsOfDistance(\r\n      { latitude: this.latitude, longitude: this.longitude },\r\n      10000\r\n    );\r\n\r\n    return ctx.prisma.house.findMany({\r\n      where: {\r\n        latitude: { gte: bounds[0].latitude, lte: bounds[1].latitude },\r\n        longitude: { gte: bounds[0].longitude, lte: bounds[1].longitude },\r\n        id: { not: { equals: this.id } },\r\n      },\r\n      take: 25,\r\n    });\r\n  }\r\n}\r\n\r\n@Resolver()\r\nexport class HouseResolver {\r\n  @Query((_returns) => House, { nullable: true })\r\n  async house(@Arg(\"id\") id: string, @Ctx() ctx: Context) {\r\n    return ctx.prisma.house.findOne({ where: { id: parseInt(id, 10) } });\r\n  }\r\n\r\n  @Query((_returns) => [House], { nullable: false })\r\n  async houses(@Arg(\"bounds\") bounds: BoundsInput, @Ctx() ctx: Context) {\r\n    return ctx.prisma.house.findMany({\r\n      where: {\r\n        latitude: { gte: bounds.sw.latitude, lte: bounds.ne.latitude },\r\n        longitude: { gte: bounds.sw.longitude, lte: bounds.ne.longitude },\r\n      },\r\n      take: 50,\r\n    });\r\n  }\r\n\r\n  @Authorized()\r\n  @Mutation((_returns) => House, { nullable: true })\r\n  async createHouse(\r\n    @Arg(\"input\") input: HouseInput,\r\n    @Ctx() ctx: AuthorizedContext\r\n  ) {\r\n    return await ctx.prisma.house.create({\r\n      data: {\r\n        userId: ctx.uid,\r\n        image: input.image,\r\n        address: input.address,\r\n        latitude: input.coordinates.latitude,\r\n        longitude: input.coordinates.longitude,\r\n        bedrooms: input.bedrooms,\r\n      },\r\n    });\r\n  }\r\n\r\n  @Authorized()\r\n  @Mutation((_returns) => House, { nullable: true })\r\n  async updateHouse(\r\n    @Arg(\"id\") id: string,\r\n    @Arg(\"input\") input: HouseInput,\r\n    @Ctx() ctx: AuthorizedContext\r\n  ) {\r\n    const houseId = parseInt(id, 10);\r\n    const house = await ctx.prisma.house.findOne({ where: { id: houseId } });\r\n\r\n    if (!house || house.userId !== ctx.uid) return null;\r\n\r\n    return await ctx.prisma.house.update({\r\n      where: { id: houseId },\r\n      data: {\r\n        image: input.image,\r\n        address: input.address,\r\n        latitude: input.coordinates.latitude,\r\n        longitude: input.coordinates.longitude,\r\n        bedrooms: input.bedrooms,\r\n      },\r\n    });\r\n  }\r\n\r\n  @Authorized()\r\n  @Mutation((_returns) => Boolean, { nullable: false })\r\n  async deleteHouse(\r\n    @Arg(\"id\") id: string,\r\n    @Ctx() ctx: AuthorizedContext\r\n  ): Promise<boolean> {\r\n    const houseId = parseInt(id, 10);\r\n    const house = await ctx.prisma.house.findOne({ where: { id: houseId } });\r\n\r\n    if (!house || house.userId !== ctx.uid) return false;\r\n\r\n    await ctx.prisma.house.delete({\r\n      where: { id: houseId },\r\n    });\r\n    return true;\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}