{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Windows\\\\Desktop\\\\housestreetcourse\\\\house-course\\\\src\\\\auth\\\\useAuth.tsx\",\n    _this = this,\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { useEffect, useState, useContext, createContext } from \"react\";\nimport { useRouter } from \"next/router\";\nimport firebase from \"firebase/app\";\nimport \"firebase/auth\";\nimport initFirebase from \"./initFirebase\";\nimport { removeTokenCookie, setTokenCookie } from \"./tokenCookies\";\ninitFirebase();\nvar AuthContext = /*#__PURE__*/createContext({\n  user: null,\n  logout: function logout() {\n    return null;\n  },\n  authenticated: false\n});\nexport var AuthProvider = function AuthProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n\n  var _useState = useState(null),\n      user = _useState[0],\n      setUser = _useState[1];\n\n  var router = useRouter();\n\n  var logout = function logout() {\n    firebase.auth().signOut().then(function () {\n      router.push(\"/\");\n    })[\"catch\"](function (e) {\n      console.error(e);\n    });\n  };\n\n  useEffect(function () {\n    var cancelAuthListener = firebase.auth().onIdTokenChanged( /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(user) {\n        var token;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!user) {\n                  _context.next = 8;\n                  break;\n                }\n\n                _context.next = 3;\n                return user.getIdToken();\n\n              case 3:\n                token = _context.sent;\n                setTokenCookie(token);\n                setUser(user);\n                _context.next = 10;\n                break;\n\n              case 8:\n                removeTokenCookie();\n                setUser(null);\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n    return function () {\n      cancelAuthListener();\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user: user,\n      logout: logout,\n      authenticated: !!user\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(AuthProvider, \"ocZTZ8m72GkfgAfkTHk7sW+OJyw=\", false, function () {\n  return [useRouter];\n});\n\n_c = AuthProvider;\nexport function useAuth() {\n  _s2();\n\n  return useContext(AuthContext);\n}\n\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["C:/Users/Windows/Desktop/housestreetcourse/house-course/src/auth/useAuth.tsx"],"names":["useEffect","useState","useContext","createContext","useRouter","firebase","initFirebase","removeTokenCookie","setTokenCookie","AuthContext","user","logout","authenticated","AuthProvider","children","setUser","router","auth","signOut","then","push","e","console","error","cancelAuthListener","onIdTokenChanged","getIdToken","token","useAuth"],"mappings":";;;;;;;;;AAAA,SACEA,SADF,EAEEC,QAFF,EAGEC,UAHF,EAIEC,aAJF,QAMO,OANP;AAOA,SAASC,SAAT,QAA0B,aAA1B;AACA,OAAOC,QAAP,MAAqB,cAArB;AACA,OAAO,eAAP;AACA,OAAOC,YAAP,MAAyB,gBAAzB;AACA,SAASC,iBAAT,EAA4BC,cAA5B,QAAkD,gBAAlD;AAEAF,YAAY;AAQZ,IAAMG,WAAW,gBAAGN,aAAa,CAAe;AAC9CO,EAAAA,IAAI,EAAE,IADwC;AAE9CC,EAAAA,MAAM,EAAE;AAAA,WAAM,IAAN;AAAA,GAFsC;AAG9CC,EAAAA,aAAa,EAAE;AAH+B,CAAf,CAAjC;AAMA,OAAO,IAAMC,YAA+B,GAAG,SAAlCA,YAAkC,OAAkB;AAAA;;AAAA,MAAfC,QAAe,QAAfA,QAAe;;AAAA,kBACvCb,QAAQ,CAAuB,IAAvB,CAD+B;AAAA,MACxDS,IADwD;AAAA,MAClDK,OADkD;;AAE/D,MAAMC,MAAM,GAAGZ,SAAS,EAAxB;;AAEA,MAAMO,MAAM,GAAG,SAATA,MAAS,GAAM;AACnBN,IAAAA,QAAQ,CACLY,IADH,GAEGC,OAFH,GAGGC,IAHH,CAGQ,YAAM;AACVH,MAAAA,MAAM,CAACI,IAAP,CAAY,GAAZ;AACD,KALH,WAMS,UAACC,CAAD,EAAO;AACZC,MAAAA,OAAO,CAACC,KAAR,CAAcF,CAAd;AACD,KARH;AASD,GAVD;;AAYArB,EAAAA,SAAS,CAAC,YAAM;AACd,QAAMwB,kBAAkB,GAAGnB,QAAQ,CAChCY,IADwB,GAExBQ,gBAFwB;AAAA,2EAEP,iBAAOf,IAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACZA,IADY;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAEMA,IAAI,CAACgB,UAAL,EAFN;;AAAA;AAERC,gBAAAA,KAFQ;AAGdnB,gBAAAA,cAAc,CAACmB,KAAD,CAAd;AACAZ,gBAAAA,OAAO,CAACL,IAAD,CAAP;AAJc;AAAA;;AAAA;AAMdH,gBAAAA,iBAAiB;AACjBQ,gBAAAA,OAAO,CAAC,IAAD,CAAP;;AAPc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAFO;;AAAA;AAAA;AAAA;AAAA,QAA3B;AAaA,WAAO,YAAM;AACXS,MAAAA,kBAAkB;AACnB,KAFD;AAGD,GAjBQ,EAiBN,EAjBM,CAAT;AAmBA,sBACE,QAAC,WAAD,CAAa,QAAb;AAAsB,IAAA,KAAK,EAAE;AAAEd,MAAAA,IAAI,EAAJA,IAAF;AAAQC,MAAAA,MAAM,EAANA,MAAR;AAAgBC,MAAAA,aAAa,EAAE,CAAC,CAACF;AAAjC,KAA7B;AAAA,cACGI;AADH;AAAA;AAAA;AAAA;AAAA,WADF;AAKD,CAxCM;;GAAMD,Y;UAEIT,S;;;KAFJS,Y;AA0Cb,OAAO,SAASe,OAAT,GAAmB;AAAA;;AACxB,SAAO1B,UAAU,CAACO,WAAD,CAAjB;AACD;;IAFemB,O","sourcesContent":["import {\r\n  useEffect,\r\n  useState,\r\n  useContext,\r\n  createContext,\r\n  FunctionComponent,\r\n} from \"react\";\r\nimport { useRouter } from \"next/router\";\r\nimport firebase from \"firebase/app\";\r\nimport \"firebase/auth\";\r\nimport initFirebase from \"./initFirebase\";\r\nimport { removeTokenCookie, setTokenCookie } from \"./tokenCookies\";\r\n\r\ninitFirebase();\r\n\r\ninterface IAuthContext {\r\n  user: firebase.User | null;\r\n  logout: () => void;\r\n  authenticated: boolean;\r\n}\r\n\r\nconst AuthContext = createContext<IAuthContext>({\r\n  user: null,\r\n  logout: () => null,\r\n  authenticated: false,\r\n});\r\n\r\nexport const AuthProvider: FunctionComponent = ({ children }) => {\r\n  const [user, setUser] = useState<firebase.User | null>(null);\r\n  const router = useRouter();\r\n\r\n  const logout = () => {\r\n    firebase\r\n      .auth()\r\n      .signOut()\r\n      .then(() => {\r\n        router.push(\"/\");\r\n      })\r\n      .catch((e) => {\r\n        console.error(e);\r\n      });\r\n  };\r\n\r\n  useEffect(() => {\r\n    const cancelAuthListener = firebase\r\n      .auth()\r\n      .onIdTokenChanged(async (user) => {\r\n        if (user) {\r\n          const token = await user.getIdToken();\r\n          setTokenCookie(token);\r\n          setUser(user);\r\n        } else {\r\n          removeTokenCookie();\r\n          setUser(null);\r\n        }\r\n      });\r\n\r\n    return () => {\r\n      cancelAuthListener();\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, logout, authenticated: !!user }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport function useAuth() {\r\n  return useContext(AuthContext);\r\n}\r\n"]},"metadata":{},"sourceType":"module"}